{"version":3,"file":"static/js/async/rename/page.5fce42fb.js","sources":["webpack://batch-rename-video-files/./node_modules/.pnpm/@modern-js-reduck+store@1.1.13/node_modules/@modern-js-reduck/store/dist/esm/model/model.js","webpack://batch-rename-video-files/./src/models/file-list.ts","webpack://batch-rename-video-files/./src/models/task-list.ts","webpack://batch-rename-video-files/./src/routes/rename/page.tsx","webpack://batch-rename-video-files/./src/routes/rename/index.module.scss","webpack://batch-rename-video-files/./src/utils.ts"],"sourcesContent":["import { initializerSymbol } from \"../utils/misc\";\nconst model = (name) => ({\n  define(modelDesc) {\n    let modelInitializer;\n    if (typeof modelDesc === \"function\") {\n      modelInitializer = modelDesc;\n    } else {\n      modelInitializer = () => modelDesc;\n    }\n    const modelCache = /* @__PURE__ */ new Map();\n    const createResponse = (initializer) => {\n      const response = (namespace) => {\n        const cachedModel = modelCache.get(namespace);\n        if (cachedModel) {\n          return cachedModel;\n        }\n        const clonedModelInitializer = (...args) => {\n          const result = initializer(...args);\n          return result;\n        };\n        const modelInstance = createResponse(clonedModelInitializer);\n        modelCache.set(namespace, modelInstance);\n        modelInstance._name = namespace || name;\n        return modelInstance;\n      };\n      response._name = name;\n      Object.defineProperty(response, initializerSymbol, {\n        configurable: false,\n        enumerable: false,\n        value: initializer\n      });\n      return response;\n    };\n    return createResponse(modelInitializer);\n  }\n});\nexport default model;\n","import { model } from '@modern-js/runtime/model';\n\ntype State = {\n\tfileList: File[];\n};\n\nexport default model<State>('file-list').define({\n\tstate: {\n\t\tfileList: [],\n\t},\n\tactions: {\n\t\tsetFileList: (draft: State, payload: File[]) => {\n\t\t\tdraft.fileList = payload;\n\t\t},\n\t},\n});\n","import { sleep } from '@/utils';\nimport { model } from '@modern-js/runtime/model';\n\ntype State = {\n\ttaskList: Array<() => void>;\n};\n\nexport default model<State>('task-list').define({\n\tstate: {\n\t\ttaskList: [],\n\t},\n\tactions: {\n\t\tresetTaskList: (draft: State) => {\n\t\t\tdraft.taskList = [];\n\t\t},\n\t\taddTask: (draft: State, payload: () => void) => {\n\t\t\tdraft.taskList.push(payload);\n\t\t},\n\t\texecuteAllTask: (draft: State) => {\n\t\t\tconst f = async (taskList: State['taskList']) => {\n\t\t\t\twhile (taskList.length > 0) {\n\t\t\t\t\tconst task = taskList.shift();\n\t\t\t\t\tawait sleep(1000);\n\t\t\t\t\ttask?.();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tf([...draft.taskList]);\n\t\t},\n\t},\n});\n","import fileListModel from '@/models/file-list';\nimport taskListModel from '@/models/task-list';\nimport { downloadFile } from '@/utils';\nimport { Input, Space, Typography } from '@douyinfe/semi-ui';\nimport { useModel } from '@modern-js/runtime/model';\nimport { useNavigate } from '@modern-js/runtime/router';\nimport { type FC, useEffect, useRef, useState } from 'react';\nimport Style from './index.module.scss';\n\nconst Index: FC = () => {\n\tconst navigate = useNavigate();\n\tconst videoRef = useRef<HTMLVideoElement | null>(null);\n\tconst [{ fileList }] = useModel(fileListModel);\n\tconst [_, { addTask }] = useModel(taskListModel);\n\tconst [curFileIndex, setCurFileIndex] = useState(0);\n\tconst [newFileName, setNewFileName] = useState('');\n\n\tuseEffect(() => {\n\t\tplayVideo(curFileIndex);\n\t}, [curFileIndex]);\n\n\tconst playVideo = (fileIndex: number) => {\n\t\tconst file = fileList[fileIndex];\n\t\tif (videoRef.current) {\n\t\t\tvideoRef.current.src = URL.createObjectURL(file);\n\t\t}\n\t};\n\n\tconst handleConfirm = () => {\n\t\tif (!newFileName) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst file = fileList[curFileIndex];\n\t\t// 因为传 () => void 会被执行，所以这里要传 () => () => void\n\t\taddTask(() => () => downloadFile(file, newFileName));\n\n\t\tif (curFileIndex === fileList.length - 1) {\n\t\t\tnavigate('/exe-rename');\n\t\t} else {\n\t\t\tsetCurFileIndex(curFileIndex + 1);\n\t\t\tsetNewFileName('');\n\t\t}\n\t};\n\n\treturn (\n\t\t<Space className={Style.page} vertical>\n\t\t\t<Typography.Title heading={2}>{`第 ${curFileIndex + 1} 个（共 ${\n\t\t\t\tfileList.length\n\t\t\t} 个）`}</Typography.Title>\n\t\t\t{/* biome-ignore lint/a11y/useMediaCaption: <explanation> */}\n\t\t\t<video ref={videoRef} controls className={Style.video} />\n\t\t\t<Space className={Style.renameArea} vertical align=\"start\">\n\t\t\t\t<Typography.Text>新文件名（按回车键确认）：</Typography.Text>\n\t\t\t\t<Input\n\t\t\t\t\tautoFocus\n\t\t\t\t\tvalue={newFileName}\n\t\t\t\t\tonChange={setNewFileName}\n\t\t\t\t\tonEnterPress={handleConfirm}\n\t\t\t\t/>\n\t\t\t</Space>\n\t\t</Space>\n\t);\n};\n\nexport default Index;\n","// extracted by css-extract-rspack-plugin\nexport default {\"page\":\"page-FxqbHo\",\"video\":\"video-p4bWwx\",\"renameArea\":\"renameArea-TG3LqX\"};","export const downloadFile = (file: File, fileName: string) => {\n\tconst newFile = new File([file], fileName, { type: file.type });\n\n\tconst aTag = document.createElement('a');\n\taTag.href = URL.createObjectURL(newFile);\n\taTag.download = newFile.name;\n\n\tdocument.body.appendChild(aTag);\n\taTag.click();\n\tdocument.body.removeChild(aTag);\n};\n\nexport const sleep = async (ms: number) =>\n\tnew Promise(resolve => {\n\t\tsetTimeout(resolve, ms);\n\t});\n"],"names":["Map","r","Object","model","draft","payload","taskList","task","sleep","navigate","useNavigate","videoRef","useRef","fileList","useModel","fileListModel","_","addTask","taskListModel","curFileIndex","setCurFileIndex","useState","newFileName","setNewFileName","useEffect","playVideo","fileIndex","file","URL","Space","Typography","Input","downloadFile","fileName","newFile","File","aTag","document","ms","Promise","resolve","setTimeout"],"mappings":"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"}